<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ingphotobooth - Online Photobooth</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;700;800&display=swap');

        :root {
            --brand-black: #000000;
            --brand-gray: #64748b;
            --light-bg: #fdfdfd;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--light-bg);
            color: #1a1a1a;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* Video Wrapper Responsif */
        .video-wrapper {
            position: relative;
            border: 8px solid white;
            border-radius: 20px;
            overflow: hidden;
            aspect-ratio: 4 / 3;
            background: #f1f5f9;
            box-shadow: 0 15px 35px -10px rgba(0, 0, 0, 0.08);
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
        }

        @media (min-width: 768px) {
            .video-wrapper {
                border-width: 12px;
                border-radius: 32px;
            }
        }

        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
        }

        .mirror-off #video {
            transform: scaleX(1);
        }

        /* Flash Effect */
        #flash {
            position: fixed;
            inset: 0;
            background: white;
            opacity: 0;
            pointer-events: none;
            z-index: 100;
        }

        .flash-active {
            animation: flash-anim 0.3s ease-out;
        }

        @keyframes flash-anim {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }

        /* Filter Video */
        .filter-bw { filter: grayscale(1) contrast(1.1); }
        .filter-sepia { filter: sepia(0.6) contrast(0.9); }
        .filter-vibrant { filter: saturate(1.4) brightness(1.05); }
        .filter-soft { filter: brightness(1.1) saturate(0.9) contrast(0.95); }

        .mode-btn.active {
            background-color: var(--brand-black);
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .capture-btn {
            background-color: var(--brand-black);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Countdown Responsive Size */
        #countdown-text {
            font-size: clamp(6rem, 30vw, 14rem);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="flash"></div>

    <!-- Navigasi Terpusat -->
    <nav class="p-6 md:p-10 max-w-7xl mx-auto w-full relative">
        <div class="flex flex-col items-center justify-center text-center">
            <h1 class="text-2xl md:text-4xl font-extrabold tracking-tighter leading-none">ingphotobooth<span class="text-gray-400">.</span></h1>
            <p class="text-[9px] md:text-[11px] uppercase tracking-[0.3em] font-bold text-gray-400 mt-2">Online Photobooth Experience</p>
        </div>
        
        <!-- Tombol Mirror di Pojok Kanan -->
        <div class="absolute right-6 top-1/2 -translate-y-1/2 flex items-center gap-4">
            <button id="btn-mirror" class="bg-white hover:bg-slate-50 p-2 md:p-3 rounded-lg md:rounded-xl transition-all border border-slate-200 shadow-sm text-slate-600" title="Balik Kamera">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 md:h-5 md:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                </svg>
            </button>
        </div>

        <!-- Indikator Status di Pojok Kiri (Desktop Only) -->
        <div class="absolute left-6 top-1/2 -translate-y-1/2 hidden md:flex items-center gap-2 text-[10px] font-bold text-gray-300 uppercase tracking-widest">
            <span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span>
            LIVE
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 md:px-6 grid grid-cols-1 lg:grid-cols-12 gap-6 md:gap-10 py-2 md:py-4 flex-grow w-full">
        
        <!-- Area Kamera -->
        <div class="lg:col-span-8 flex flex-col gap-4 md:gap-8">
            <div class="video-wrapper">
                <video id="video" autoplay playsinline></video>
                <div id="countdown-ui" class="absolute inset-0 flex items-center justify-center pointer-events-none">
                    <span id="countdown-text" class="font-extrabold text-white opacity-0 transition-all duration-500 drop-shadow-2xl">3</span>
                </div>
            </div>

            <!-- Panel Kontrol -->
            <div class="bg-white border border-slate-100 p-4 md:p-8 rounded-3xl md:rounded-[40px] shadow-sm flex flex-col md:flex-row items-center justify-around gap-6 md:gap-8">
                
                <!-- Pilihan Filter -->
                <div class="flex flex-col gap-2 w-full md:w-auto">
                    <label class="text-[9px] md:text-[10px] uppercase tracking-widest text-slate-400 font-bold ml-1 text-center md:text-left">Filter</label>
                    <select id="filter-select" class="bg-slate-50 text-slate-800 px-4 py-2.5 md:px-5 md:py-3 rounded-xl md:rounded-2xl outline-none border border-slate-200 focus:border-black transition-all cursor-pointer font-semibold text-xs md:text-sm w-full">
                        <option value="none">Original</option>
                        <option value="filter-bw">Noir B&W</option>
                        <option value="filter-sepia">Vintage</option>
                        <option value="filter-vibrant">Vibrant</option>
                        <option value="filter-soft">Soft Glow</option>
                    </select>
                </div>

                <!-- Tombol Ambil Foto -->
                <div class="relative order-first md:order-none">
                    <div id="capture-loader" class="absolute -inset-2 md:-inset-3 rounded-full border-4 border-black border-t-transparent animate-spin hidden"></div>
                    <button id="main-capture-btn" class="capture-btn w-16 h-16 md:w-20 md:h-20 lg:w-24 lg:h-24 rounded-full flex items-center justify-center shadow-xl shadow-black/10 active:scale-90 touch-none">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 md:w-10 md:h-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                    </button>
                </div>

                <!-- Pilihan Layout -->
                <div class="flex flex-col gap-2 w-full md:w-auto">
                    <label class="text-[9px] md:text-[10px] uppercase tracking-widest text-slate-400 font-bold ml-1 text-center md:text-left">Layout</label>
                    <div class="flex gap-1 p-1 bg-slate-50 rounded-xl md:rounded-2xl border border-slate-100">
                        <button data-mode="single" class="mode-btn active flex-1 md:flex-none px-4 md:px-6 py-2 rounded-lg md:rounded-xl font-bold text-[10px] md:text-xs transition-all">Single</button>
                        <button data-mode="strip" class="mode-btn flex-1 md:flex-none px-4 md:px-6 py-2 rounded-lg md:rounded-xl font-bold text-[10px] md:text-xs transition-all text-slate-400">4-Strip</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar Galeri -->
        <div class="lg:col-span-4 flex flex-col gap-4 md:gap-6 mt-4 lg:mt-0">
            <div class="flex justify-between items-end px-2">
                <div>
                    <h3 class="text-xs md:text-sm font-extrabold text-slate-900 uppercase tracking-widest">Karya Anda</h3>
                    <p class="text-[9px] md:text-[10px] text-slate-400 font-medium">Ketuk untuk unduh</p>
                </div>
                <button id="btn-clear" class="text-[9px] md:text-[10px] text-slate-300 hover:text-black font-bold uppercase tracking-widest transition-colors">Reset</button>
            </div>
            
            <div id="gallery" class="flex flex-row lg:flex-col gap-4 overflow-x-auto lg:overflow-y-auto lg:max-h-[60vh] pb-6 px-1 lg:px-2 snap-x">
                <!-- Status Kosong -->
                <div id="empty-state" class="min-w-[200px] w-full py-12 md:py-24 border-2 border-dashed border-slate-100 rounded-3xl flex flex-col items-center justify-center gap-3 md:gap-4 bg-white">
                    <div class="w-10 h-10 md:w-14 md:h-14 bg-slate-50 rounded-full flex items-center justify-center text-slate-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 md:h-6 md:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                    </div>
                    <p class="text-[9px] md:text-[10px] text-slate-300 font-black uppercase tracking-[0.2em]">Ready to Snap</p>
                </div>
            </div>
        </div>
    </main>

    <canvas id="canvas" class="hidden"></canvas>

    <footer class="mt-auto py-6 md:py-10 text-center border-t border-slate-100 bg-white/50">
        <p class="text-[8px] md:text-[10px] text-slate-400 font-bold uppercase tracking-[0.2em] md:tracking-[0.3em] px-4">
            &copy; 2024 ingphotobooth memorable photobooth experience
        </p>
    </footer>

    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const mainBtn = document.getElementById('main-capture-btn');
        const filterSelect = document.getElementById('filter-select');
        const gallery = document.getElementById('gallery');
        const countdownUI = document.getElementById('countdown-text');
        const flash = document.getElementById('flash');
        const emptyState = document.getElementById('empty-state');
        const clearBtn = document.getElementById('btn-clear');
        const btnMirror = document.getElementById('btn-mirror');
        const modeBtns = document.querySelectorAll('.mode-btn');

        let isMirror = true;
        let captureMode = 'single';
        let isCapturing = false;

        async function init() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: { ideal: 1280 },
                        height: { ideal: 720 },
                        facingMode: "user"
                    }, 
                    audio: false 
                });
                video.srcObject = stream;
            } catch (e) {
                console.error(e);
                alert("Mohon izinkan kamera untuk memulai sesi photobooth.");
            }
        }

        modeBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                modeBtns.forEach(b => {
                    b.classList.remove('active', 'bg-black', 'text-white');
                    b.classList.add('text-slate-400');
                });
                btn.classList.add('active');
                captureMode = btn.dataset.mode;
            });
        });

        btnMirror.addEventListener('click', () => {
            isMirror = !isMirror;
            document.querySelector('.video-wrapper').classList.toggle('mirror-off', !isMirror);
        });

        mainBtn.addEventListener('click', async (e) => {
            e.preventDefault();
            if (isCapturing) return;
            isCapturing = true;
            document.getElementById('capture-loader').classList.remove('hidden');

            if (captureMode === 'single') {
                await startCountdown(3);
                const frame = takeFrame();
                createSinglePhoto(frame);
            } else {
                const frames = [];
                for (let i = 1; i <= 4; i++) {
                    await startCountdown(3);
                    frames.push(takeFrame());
                }
                await createPhotoStrip(frames);
            }

            isCapturing = false;
            document.getElementById('capture-loader').classList.add('hidden');
        });

        function startCountdown(sec) {
            return new Promise(resolve => {
                let current = sec;
                countdownUI.innerText = current;
                countdownUI.classList.remove('opacity-0');
                countdownUI.classList.add('scale-150', 'opacity-100');

                const timer = setInterval(() => {
                    current--;
                    if (current <= 0) {
                        clearInterval(timer);
                        countdownUI.classList.remove('opacity-100', 'scale-150');
                        countdownUI.classList.add('opacity-0');
                        resolve();
                    } else {
                        countdownUI.innerText = current;
                    }
                }, 1000);
            });
        }

        function takeFrame() {
            flash.classList.add('flash-active');
            setTimeout(() => flash.classList.remove('flash-active'), 300);

            try {
                const audio = new (window.AudioContext || window.webkitAudioContext)();
                const osc = audio.createOscillator();
                const gain = audio.createGain();
                osc.connect(gain); gain.connect(audio.destination);
                osc.start(); gain.gain.exponentialRampToValueAtTime(0.0001, audio.currentTime + 0.1);
                osc.stop(audio.currentTime + 0.1);
            } catch(e) {}

            const ctx = canvas.getContext('2d');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            ctx.save();
            if (isMirror) {
                ctx.scale(-1, 1);
                ctx.translate(-canvas.width, 0);
            }
            ctx.filter = getComputedStyle(video).filter;
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            ctx.restore();

            return canvas.toDataURL('image/png');
        }

        function createSinglePhoto(url) {
            emptyState.style.display = 'none';
            const id = Date.now();
            const div = document.createElement('div');
            div.className = "group relative animate-in fade-in zoom-in duration-500 bg-white p-2 md:p-3 rounded-2xl md:rounded-[32px] border border-slate-100 shadow-sm min-w-[240px] md:min-w-full snap-center";
            div.innerHTML = `
                <img src="${url}" class="w-full rounded-xl md:rounded-[24px]">
                <div class="absolute inset-0 bg-white/90 opacity-0 group-hover:opacity-100 lg:group-hover:opacity-100 transition-all rounded-2xl md:rounded-[32px] flex items-center justify-center gap-3 md:gap-4 backdrop-blur-md">
                    <button onclick="download('${url}', 'ing-snap-${id}.png')" class="bg-black text-white p-3 md:p-4 rounded-full hover:scale-110 transition-transform shadow-xl">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 md:h-6 md:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                        </svg>
                    </button>
                    <button onclick="this.parentElement.parentElement.remove(); checkEmpty();" class="bg-slate-100 text-slate-400 p-3 md:p-4 rounded-full hover:text-red-500 transition-all">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 md:h-6 md:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                    </button>
                </div>
                <div class="lg:hidden mt-2 flex justify-center">
                    <button onclick="download('${url}', 'ing-snap-${id}.png')" class="text-[9px] font-bold text-slate-400 uppercase tracking-widest">Sentuh untuk Simpan</button>
                </div>
            `;
            gallery.prepend(div);
        }

        async function createPhotoStrip(urls) {
            emptyState.style.display = 'none';
            const stripCanvas = document.createElement('canvas');
            const sCtx = stripCanvas.getContext('2d');
            
            stripCanvas.width = 800;
            stripCanvas.height = 2800;

            sCtx.fillStyle = "white";
            sCtx.fillRect(0, 0, stripCanvas.width, stripCanvas.height);

            let y = 60;
            for (let url of urls) {
                const img = await loadImage(url);
                sCtx.drawImage(img, 60, y, 680, 510);
                y += 570;
            }

            sCtx.fillStyle = "black";
            sCtx.font = "800 60px 'Plus Jakarta Sans'";
            sCtx.textAlign = "center";
            sCtx.fillText("ingphotobooth.", 400, y + 140);
            
            sCtx.fillStyle = "#94a3b8";
            sCtx.font = "500 24px 'Plus Jakarta Sans'";
            sCtx.letterSpacing = "4px";
            sCtx.fillText("MEMORABLE EXPERIENCE", 400, y + 200);

            const finalUrl = stripCanvas.toDataURL('image/png');
            createSinglePhoto(finalUrl);
        }

        function loadImage(src) {
            return new Promise(resolve => {
                const img = new Image();
                img.onload = () => resolve(img);
                img.src = src;
            });
        }

        window.download = (url, name) => {
            const a = document.createElement('a');
            a.href = url;
            a.download = name;
            a.click();
        };

        window.checkEmpty = () => {
            if (gallery.querySelectorAll('.group').length === 0) {
                emptyState.style.display = 'flex';
            }
        };

        filterSelect.addEventListener('change', () => {
            video.className = filterSelect.value;
        });

        clearBtn.addEventListener('click', () => {
            gallery.querySelectorAll('.group').forEach(e => e.remove());
            checkEmpty();
        });

        init();
    </script>
</body>
</html>
